<div class="games-information">
	<%= render 'shared/game_details' %>
	<hr />
	<% if player_signed_in? %>
		<%= render 'shared/my_games' %>
		<hr />
		<%= render 'shared/open_games' %>
	<% end %>
</div>

<div class='game-container'>
	<%= render 'shared/gameboard' %>
</div>

<script>
	$(document).ready(function() {
		// boolean to determine if a piece has been selected
		var piece_selected = false;
		// set up variables for ajax call
		var piece_x_position,
				piece_y_position,
				destination_x_position,
				destination_y_position,
				piecePathUrl;


		// set up click listener for all tds on gameboard
		$('#gameboard td').click( function() {
			if (piece_selected) {
				// a piece has already been selected, look for destination
				if ( $(this).hasClass('piece-selected') ) {
					// if this was the piece that was already selected, deselect and reset
					deselectPiece(this);
				} else {
					// this must be the destination, make ajax call for a move
					sendMove(this);
				}
			} else {
				// no piece has been selected, select this piece
				selectPiece(this);
			}
		});

		function deselectPiece( piece ) {
			$(piece).removeClass('piece-selected');
			piece_selected = false;
			console.log('deselect piece');
		}

		// this piece (passed as this from click handler) was 
		// selected, give it a styling class, set 
		// boolean and variables
		function selectPiece( piece ) {
			$(piece).addClass('piece-selected');
			piece_selected = true; 
			piece_x_position = $(piece).data("x-position");
			piece_y_position = $(piece).data("y-position");
			console.log('select piece at ', piece_x_position, piece_y_position );
			piecePathUrl = '/pieces/' + $(piece).data("piece-id");
		}

		function sendMove( destination ) {
			// source and destination are selected, send ajax call
			destination_x_position = $(destination).data("x-position");
			destination_y_position = $(destination).data("y-position");

			$.ajax({
				type: 'PUT',
				url: piecePathUrl,
				dataType: 'json',
				data: { piece: { 
								x_position: destination_x_position,
								y_position: destination_y_position 
								}
							},
				success: function(data) {
					$(location).attr('href', data.update_url);
				}
			});		
		}

	});

</script>
